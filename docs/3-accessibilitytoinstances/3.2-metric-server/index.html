<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.131.0">
    <meta name="description" content="">
<meta name="author" content="thanhnhan4770@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Prometheus - Adapter :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1727014810" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1727014810" rel="stylesheet">
    <link href="/css/hybrid.css?1727014810" rel="stylesheet">
    <link href="/css/featherlight.min.css?1727014810" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1727014810" rel="stylesheet">
    <link href="/css/auto-complete.css?1727014810" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1727014810" rel="stylesheet">
    <link href="/css/theme.css?1727014810" rel="stylesheet">
    <link href="/css/hugo-theme.css?1727014810" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1727014810" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1727014810"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/3-accessibilitytoinstances/3.2-metric-server/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1727014810"></script>
<script type="text/javascript" src="/js/auto-complete.js?1727014810"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1727014810"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-kubernetesarchitecture/" title="Kubernetes Architecture" class="dd-item 
        
        
        
        ">
      <a href="/1-kubernetesarchitecture/">
           <b> 1. </b> Kubernetes Architecture
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-kubernetesarchitecture/1.1-kubernetescomponents/" title="Kubernetes Components" class="dd-item 
        
        
        
        ">
      <a href="/1-kubernetesarchitecture/1.1-kubernetescomponents/">
           <b> 1.1 </b> Kubernetes Components
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-kubernetesarchitecture/1.2-kubernetesnetworking/" title="Kubernetes Networking" class="dd-item 
        
        
        
        ">
      <a href="/1-kubernetesarchitecture/1.2-kubernetesnetworking/">
           <b> 1.2 </b> Kubernetes Networking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-kubernetesarchitecture/1.3-cilium/" title="Cilium" class="dd-item 
        
        
        
        ">
      <a href="/1-kubernetesarchitecture/1.3-cilium/">
           <b> 1.3 </b> Cilium
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-setuplab/" title="Setup Lab" class="dd-item 
        
        
        
        ">
      <a href="/2-setuplab/">
           <b> 2 </b> Setup Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-setuplab/2.1-createkubernetescluster/" title="Create Kubernetes Cluster" class="dd-item 
        
        
        
        ">
      <a href="/2-setuplab/2.1-createkubernetescluster/">
           <b> 2.1 </b> Create Kubernetes Cluster
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-setuplab/2.2-setuptomcat/" title="Setup Tomcat" class="dd-item 
        
        
        
        ">
      <a href="/2-setuplab/2.2-setuptomcat/">
           <b> 2.2 </b> Setup Tomcat
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/" title="Monitoring" class="dd-item 
        parent
        
        
        ">
      <a href="/3-accessibilitytoinstances/">
           <b> 3. </b> Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/3.1-prometheus/" title="Prometheus" class="dd-item 
        
        
        
        ">
      <a href="/3-accessibilitytoinstances/3.1-prometheus/">
           <b> 3.1. </b> Prometheus
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/3.2-metric-server/" title="Prometheus - Adapter" class="dd-item 
        
        active
        
        ">
      <a href="/3-accessibilitytoinstances/3.2-metric-server/">
           <b> 3.2. </b> Prometheus - Adapter
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/3.3-hpa/" title="Horizontal Pod Autoscaling - HPA" class="dd-item 
        
        
        
        ">
      <a href="/3-accessibilitytoinstances/3.3-hpa/">
           <b> 3.3. </b> Horizontal Pod Autoscaling - HPA
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/3.4-demo/" title="Demo" class="dd-item 
        
        
        
        ">
      <a href="/3-accessibilitytoinstances/3.4-demo/">
           <b> 3.4. </b> Demo
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-cleanup/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/4-cleanup/">
          <b>4. </b>Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/3-accessibilitytoinstances/3.2-metric-server/" selected>English</option>
                    
                  
              
          
              
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/3-accessibilitytoinstances/3.2-metric-server/"></option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/hiepnguyendt"  style="color:orange">Thanh Hiệp </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Session Management</a> > <a href='/3-accessibilitytoinstances/'>Monitoring</a> > Prometheus - Adapter
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Prometheus - Adapter
            </h1>
          

        



	<ul>
<li>Although HPA is installed by default in K8s, to get information for monitoring (CPU, Memory), but if you want to extend by other parameters like jmx then metricserver will not support. So i use prometheus-adapter to scale by metric &ldquo;tomcat_requestcount_total&rdquo;</li>
</ul>
<h4 id="architecture">Architecture</h4>
<p><img alt="adapter" src="/images/3.connect/adapter.png"></p>
<h4 id="1download-prometheus-adapter-manifest">1.Download Prometheus Adapter Manifest</h4>
<ul>
<li>Use below command to clone yaml file.</li>
</ul>
<pre tabindex="0"><code>git clone https://github.com/kubernetes-sigs/prometheus-adapter.git
</code></pre><ul>
<li>Move to folder deploy/manifests and you&rsquo;ll see all the necessary .yaml file</li>
<li>I need to edit some files to fit this lab. First, open the file <strong>api-service.yaml</strong></li>
</ul>
<pre tabindex="0"><code>apiVersion: apiregistration.k8s.io/v1
kind: APIService
metadata:
  labels:
    app.kubernetes.io/component: metrics-adapter
    app.kubernetes.io/name: prometheus-adapter
    app.kubernetes.io/version: 0.12.0
  #name: v1beta1.metrics.k8s.io
  name: v1beta1.custom.metrics.k8s.io
spec:
  #group: metrics.k8s.io
  group: custom.metrics.k8s.io
  groupPriorityMinimum: 100
  insecureSkipTLSVerify: true
  service:
    name: prometheus-adapter
    namespace: monitoring
  version: v1beta1
  versionPriority: 100
</code></pre><ul>
<li>
<p>since using custom metrics i changed kubernetes support API to <strong>custom.metrics.k8s.io</strong></p>
</li>
<li>
<p>Next, replace the configmap.yaml file below to determines which metrics to expose and specifies each of the steps the adapter needs to take to expose a metric in the API.</p>
</li>
</ul>
<pre tabindex="0"><code>apiVersion: v1
data:
  config.yaml: |
    rules:
    #- seriesQuery: &#39;tomcat_requestcount_total&#39;
    - seriesQuery: &#39;{__name__=~&#34;^tomcat_.*&#34;,instance!=&#34;&#34;}&#39;
      #resources: {overrides: {job: {resource: &#34;job&#34;}}}
      resources:
        overrides:
          instance: {resource: &#34;node&#34;}
          job: {resource: &#34;job&#34;}
          kubernetes_namespace: {resource: &#34;namespace&#34;}
          kubernetes_pod_name: {resource: &#34;pod&#34;}
      name:
        matches: &#34;tomcat_requestcount_total&#34;
        #matches: &#34;^tomcat_(.*)$&#34;
      metricsQuery: &#34;sum(rate(&lt;&lt;.Series&gt;&gt;{&lt;&lt;.LabelMatchers&gt;&gt;}[3m])*180) by (&lt;&lt;.GroupBy&gt;&gt;)&#34;
    externalRules:
    - seriesQuery: &#39;tomcat_requestcount_total&#39;
      resources:
        overrides:
          instance: {resource: &#34;node&#34;}
          job: {resource: &#34;job&#34;}
          kubernetes_namespace: {resource: &#34;namespace&#34;}
          kubernetes_pod_name: {resource: &#34;pod&#34;}
      name:
        matches: &#34;tomcat_requestcount_total&#34;
        as: &#34;tomcat_requestcount_total&#34;
      metricsQuery: &#34;sum(rate(&lt;&lt;.Series&gt;&gt;{&lt;&lt;.LabelMatchers&gt;&gt;}[3m])*180) by (&lt;&lt;.GroupBy&gt;&gt;)&#34;

kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/component: metrics-adapter
    app.kubernetes.io/name: prometheus-adapter
    app.kubernetes.io/version: 0.12.0
  name: adapter-config
  namespace: monitoring
</code></pre><ul>
<li>To explain a bit, Each rule can be divided into four parts:</li>
</ul>
<ul>
<li>
<p><strong>Discovery</strong> which specifies how the adapter should find all Prometheus metrics for this rule.</p>
</li>
<li>
<p><strong>Association</strong> which specifies how the adapter should determine which Kubernetes resources a particular metric is associated with.</p>
</li>
<li>
<p><strong>Naming</strong> which specifies how the adapter should expose the metric in the custom metrics API.</p>
</li>
<li>
<p><strong>Querying</strong> which specifies how a request for a particular metric on one or more Kubernetes objects should be turned into a query to Prometheus.</p>
</li>
</ul>
<ul>
<li><a href="https://github.com/kubernetes-sigs/prometheus-adapter/blob/master/docs/config.md">Read more on</a></li>
</ul>
<h4 id="2-create-prometheus-adapter">2. Create Prometheus Adapter</h4>
<ul>
<li>Follow command to complete deploy adapter.</li>
</ul>
<pre tabindex="0"><code>kubectl create -f prometheus-adapter/deploy/manifests/
</code></pre><ul>
<li>As we can see, prometheus-adapter to deploy success and running on cluster</li>
</ul>
<pre tabindex="0"><code>~# kubectl get pod -A -o wide 
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE   IP              NODE         NOMINATED NODE   READINESS GATES
app           tomcat-deployment-7fb69d4749-fnpd4      1/1     Running   0          36m   10.0.1.99       k8s-worker   &lt;none&gt;           &lt;none&gt;
kube-system   cilium-8phqv                            1/1     Running   0          76m   172.22.6.150    k8s-worker   &lt;none&gt;           &lt;none&gt;
kube-system   cilium-bgvjv                            1/1     Running   0          76m   172.22.11.124   k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   cilium-operator-79bbbc6f56-sdlwq        1/1     Running   0          76m   172.22.6.150    k8s-worker   &lt;none&gt;           &lt;none&gt;
kube-system   coredns-6f6b679f8f-6ljtz                1/1     Running   0          78m   10.0.0.8        k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   coredns-6f6b679f8f-btcxx                1/1     Running   0          78m   10.0.0.114      k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   etcd-k8s-master                         1/1     Running   0          79m   172.22.11.124   k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   kube-apiserver-k8s-master               1/1     Running   0          79m   172.22.11.124   k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   kube-controller-manager-k8s-master      1/1     Running   30         79m   172.22.11.124   k8s-master   &lt;none&gt;           &lt;none&gt;
kube-system   kube-scheduler-k8s-master               1/1     Running   30         79m   172.22.11.124   k8s-master   &lt;none&gt;           &lt;none&gt;
monitoring    prometheus-adapter-777cb6d9d8-5lpp8     1/1     Running   0          32m   10.0.1.58       k8s-worker   &lt;none&gt;           &lt;none&gt;
monitoring    prometheus-deployment-5b9f6c9dd-z8s9f   1/1     Running   0          36m   10.0.1.30       k8s-worker   &lt;none&gt;           &lt;none&gt;
</code></pre><ul>
<li>Let’s check what all custom metrics are available.</li>
</ul>
<pre tabindex="0"><code>~# kubectl get --raw &#34;/apis/custom.metrics.k8s.io/v1beta1/&#34; | jq .
{
  &#34;kind&#34;: &#34;APIResourceList&#34;,
  &#34;apiVersion&#34;: &#34;v1&#34;,
  &#34;groupVersion&#34;: &#34;custom.metrics.k8s.io/v1beta1&#34;,
  &#34;resources&#34;: [
    {
      &#34;name&#34;: &#34;namespaces/tomcat_requestcount_total&#34;,
      &#34;singularName&#34;: &#34;&#34;,
      &#34;namespaced&#34;: false,
      &#34;kind&#34;: &#34;MetricValueList&#34;,
      &#34;verbs&#34;: [
        &#34;get&#34;
      ]
    },
    {
      &#34;name&#34;: &#34;pods/tomcat_requestcount_total&#34;,
      &#34;singularName&#34;: &#34;&#34;,
      &#34;namespaced&#34;: true,
      &#34;kind&#34;: &#34;MetricValueList&#34;,
      &#34;verbs&#34;: [
        &#34;get&#34;
      ]
    },
    {
      &#34;name&#34;: &#34;nodes/tomcat_requestcount_total&#34;,
      &#34;singularName&#34;: &#34;&#34;,
      &#34;namespaced&#34;: false,
      &#34;kind&#34;: &#34;MetricValueList&#34;,
      &#34;verbs&#34;: [
        &#34;get&#34;
      ]
    },
    {
      &#34;name&#34;: &#34;jobs.batch/tomcat_requestcount_total&#34;,
      &#34;singularName&#34;: &#34;&#34;,
      &#34;namespaced&#34;: true,
      &#34;kind&#34;: &#34;MetricValueList&#34;,
      &#34;verbs&#34;: [
        &#34;get&#34;
      ]
    }
  ]
}
</code></pre><ul>
<li>We can see that <strong>tomcat_requestcount_total</strong> metric is available on all deployment tomcat. Now, let’s check the current value of this metric.</li>
</ul>
<pre tabindex="0"><code>~# kubectl get --raw &#34;/apis/custom.metrics.k8s.io/v1beta1/namespaces/app/pods/*/tomcat_requestcount_total&#34; | jq .
{
  &#34;kind&#34;: &#34;MetricValueList&#34;,
  &#34;apiVersion&#34;: &#34;custom.metrics.k8s.io/v1beta1&#34;,
  &#34;metadata&#34;: {},
  &#34;items&#34;: [
    {
      &#34;describedObject&#34;: {
        &#34;kind&#34;: &#34;Pod&#34;,
        &#34;namespace&#34;: &#34;app&#34;,
        &#34;name&#34;: &#34;tomcat-deployment-7fb69d4749-fnpd4&#34;,
        &#34;apiVersion&#34;: &#34;/v1&#34;
      },
      &#34;metricName&#34;: &#34;tomcat_requestcount_total&#34;,
      &#34;timestamp&#34;: &#34;2024-09-16T15:53:02Z&#34;,
      &#34;value&#34;: &#34;0&#34;,
      &#34;selector&#34;: null
    }
  ]
}
</code></pre><ul>
<li>Success, this is what we need to scale in the next part.</li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/3-accessibilitytoinstances/3.1-prometheus/" title="Prometheus"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/3-accessibilitytoinstances/3.3-hpa/" title="Horizontal Pod Autoscaling - HPA" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1727014810"></script>
    <script src="/js/perfect-scrollbar.min.js?1727014810"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1727014810"></script>
    <script src="/js/jquery.sticky.js?1727014810"></script>
    <script src="/js/featherlight.min.js?1727014810"></script>
    <script src="/js/highlight.pack.js?1727014810"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1727014810"></script>
    <script src="/js/learn.js?1727014810"></script>
    <script src="/js/hugo-learn.js?1727014810"></script>

    <link href="/mermaid/mermaid.css?1727014810" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1727014810"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
